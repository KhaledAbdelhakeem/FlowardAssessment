"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FixSkippedError = exports.DoctorCheck = exports.Doctor = void 0;

require("source-map-support/register");

require("@colors/colors");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _support = require("@appium/support");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const {
  version
} = _support.fs.readPackageJsonFrom(__dirname);

class FixSkippedError extends Error {}

exports.FixSkippedError = FixSkippedError;

class DoctorCheck {
  constructor(opts = {}) {
    this.autofix = !!opts.autofix;
  }

  diagnose() {
    throw new Error('Not Implemented!');
  }

  fix() {
    throw new Error('Not Implemented!');
  }

}

exports.DoctorCheck = DoctorCheck;

class Doctor {
  constructor() {
    this.checks = [];
    this.checkOptionals = [];
    this.toFix = [];
    this.toFixOptionals = [];
  }

  register(checks) {
    checks = Array.isArray(checks) ? checks : [checks];
    this.checks = this.checks.concat(checks);
  }

  async diagnose() {
    _logger.default.info(`### Diagnostic for ${'necessary'.green} dependencies starting ###`);

    this.toFix = [];

    for (const check of this.checks) {
      const res = await check.diagnose();

      if (res.optional) {
        this.checkOptionals.push(check);
        continue;
      }

      await this.diagnosticResultMessage(res, this.toFix, check);
    }

    _logger.default.info(`### Diagnostic for necessary dependencies completed, ${await this.fixMessage(this.toFix.length)}. ###`);

    _logger.default.info('');

    _logger.default.info(`### Diagnostic for ${'optional'.yellow} dependencies starting ###`);

    this.toFixOptionals = [];

    for (const checkOptional of this.checkOptionals) {
      await this.diagnosticResultMessage(await checkOptional.diagnose(), this.toFixOptionals, checkOptional);
    }

    _logger.default.info(`### Diagnostic for optional dependencies completed, ${await this.fixMessage(this.toFixOptionals.length, true)}. ###`);

    _logger.default.info('');
  }

  async reportManualFixes(fix, fixOptioal) {
    const manualFixes = _lodash.default.filter(fix, f => {
      var _f$check;

      return !(f !== null && f !== void 0 && (_f$check = f.check) !== null && _f$check !== void 0 && _f$check.autofix);
    });

    const manualFixesOptional = _lodash.default.filter(fixOptioal, f => {
      var _f$check2;

      return !(f !== null && f !== void 0 && (_f$check2 = f.check) !== null && _f$check2 !== void 0 && _f$check2.autofix);
    });

    if (manualFixes.length > 0) {
      _logger.default.info('### Manual Fixes Needed ###');

      _logger.default.info('The configuration cannot be automatically fixed, please do the following first:');

      const fixMessages = [];

      for (const f of manualFixes) {
        fixMessages.push(await f.check.fix());
      }

      for (const m of _lodash.default.uniq(fixMessages)) {
        _logger.default.warn(` \u279C ${m}`);
      }

      _logger.default.info('');
    }

    if (manualFixesOptional.length > 0) {
      _logger.default.info('### Optional Manual Fixes ###');

      _logger.default.info('The configuration can install optionally. Please do the following manually:');

      const fixMessages = [];

      for (const f of manualFixesOptional) {
        fixMessages.push(await f.check.fix());
      }

      for (const m of _lodash.default.uniq(fixMessages)) {
        _logger.default.warn(` \u279C ${m}`);
      }

      _logger.default.info('');
    }

    if (manualFixes.length > 0 || manualFixesOptional.length > 0) {
      _logger.default.info('###');

      _logger.default.info('');

      _logger.default.info('Bye! Run appium-doctor again when all manual fixes have been applied!');

      _logger.default.info('');

      return true;
    }

    return false;
  }

  async runAutoFix(f) {
    _logger.default.info(`### Fixing: ${f.error} ###`);

    try {
      await f.check.fix();
    } catch (err) {
      if (err instanceof FixSkippedError) {
        _logger.default.info(`### Skipped fix ###`);

        return;
      } else {
        _logger.default.warn(`${err}`.replace(/\n$/g, ''));

        _logger.default.info(`### Fix did not succeed ###`);

        return;
      }
    }

    _logger.default.info('Checking if this was fixed:');

    let res = await f.check.diagnose();

    if (res.ok) {
      f.fixed = true;

      _logger.default.info(` ${'\u2714'.green} ${res.message}`);

      _logger.default.info(`### Fix was successfully applied ###`);
    } else {
      _logger.default.info(` ${'\u2716'.red} ${res.message}`);

      _logger.default.info(`### Fix was applied but issue remains ###`);
    }
  }

  async runAutoFixes() {
    let autoFixes = _lodash.default.filter(this.toFix, f => {
      var _f$check3;

      return f === null || f === void 0 ? void 0 : (_f$check3 = f.check) === null || _f$check3 === void 0 ? void 0 : _f$check3.autofix;
    });

    for (let f of autoFixes) {
      await this.runAutoFix(f);

      _logger.default.info('');
    }

    if (_lodash.default.find(autoFixes, f => !f.fixed)) {
      _logger.default.info('Bye! A few issues remain, fix manually and/or rerun appium-doctor!');
    } else {
      _logger.default.info('Bye! All issues have been fixed!');
    }

    _logger.default.info('');
  }

  async run() {
    _logger.default.info(`Appium Doctor v.${version}`);

    await this.diagnose();

    if (await this.reportSuccess(this.toFix.length, this.toFixOptionals.length)) {
      return;
    }

    if (await this.reportManualFixes(this.toFix, this.toFixOptionals)) {
      return;
    }

    await this.runAutoFixes();
  }

  async diagnosticResultMessage(result, toFixList, check) {
    if (result.ok) {
      _logger.default.info(` ${'\u2714'.green} ${result.message}`);
    } else {
      const errorMessage = result.optional ? ` ${'\u2716'.yellow} ${result.message}` : ` ${'\u2716'.red} ${result.message}`;

      _logger.default.warn(errorMessage);

      toFixList.push({
        error: errorMessage,
        check
      });
    }
  }

  async fixMessage(length, optional = false) {
    let message;

    switch (length) {
      case 0:
        message = 'no fix';
        break;

      case 1:
        message = 'one fix';
        break;

      default:
        message = `${length} fixes`;
    }

    return `${message} ${optional ? 'possible' : 'needed'}`;
  }

  async reportSuccess(length, lengthOptional) {
    if (length === 0 && lengthOptional === 0) {
      _logger.default.info('Everything looks good, bye!');

      _logger.default.info('');

      return true;
    } else {
      return false;
    }
  }

}

exports.Doctor = Doctor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ2ZXJzaW9uIiwiZnMiLCJyZWFkUGFja2FnZUpzb25Gcm9tIiwiX19kaXJuYW1lIiwiRml4U2tpcHBlZEVycm9yIiwiRXJyb3IiLCJEb2N0b3JDaGVjayIsImNvbnN0cnVjdG9yIiwib3B0cyIsImF1dG9maXgiLCJkaWFnbm9zZSIsImZpeCIsIkRvY3RvciIsImNoZWNrcyIsImNoZWNrT3B0aW9uYWxzIiwidG9GaXgiLCJ0b0ZpeE9wdGlvbmFscyIsInJlZ2lzdGVyIiwiQXJyYXkiLCJpc0FycmF5IiwiY29uY2F0IiwibG9nIiwiaW5mbyIsImdyZWVuIiwiY2hlY2siLCJyZXMiLCJvcHRpb25hbCIsInB1c2giLCJkaWFnbm9zdGljUmVzdWx0TWVzc2FnZSIsImZpeE1lc3NhZ2UiLCJsZW5ndGgiLCJ5ZWxsb3ciLCJjaGVja09wdGlvbmFsIiwicmVwb3J0TWFudWFsRml4ZXMiLCJmaXhPcHRpb2FsIiwibWFudWFsRml4ZXMiLCJfIiwiZmlsdGVyIiwiZiIsIm1hbnVhbEZpeGVzT3B0aW9uYWwiLCJmaXhNZXNzYWdlcyIsIm0iLCJ1bmlxIiwid2FybiIsInJ1bkF1dG9GaXgiLCJlcnJvciIsImVyciIsInJlcGxhY2UiLCJvayIsImZpeGVkIiwibWVzc2FnZSIsInJlZCIsInJ1bkF1dG9GaXhlcyIsImF1dG9GaXhlcyIsImZpbmQiLCJydW4iLCJyZXBvcnRTdWNjZXNzIiwicmVzdWx0IiwidG9GaXhMaXN0IiwiZXJyb3JNZXNzYWdlIiwibGVuZ3RoT3B0aW9uYWwiXSwic291cmNlcyI6WyIuLi8uLi9saWIvZG9jdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnQGNvbG9ycy9jb2xvcnMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHtmc30gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcblxuY29uc3Qge3ZlcnNpb259ID0gZnMucmVhZFBhY2thZ2VKc29uRnJvbShfX2Rpcm5hbWUpO1xuXG5jbGFzcyBGaXhTa2lwcGVkRXJyb3IgZXh0ZW5kcyBFcnJvciB7fVxuXG5jbGFzcyBEb2N0b3JDaGVjayB7XG4gIGNvbnN0cnVjdG9yKG9wdHMgPSB7fSkge1xuICAgIHRoaXMuYXV0b2ZpeCA9ICEhb3B0cy5hdXRvZml4O1xuICB9XG5cbiAgZGlhZ25vc2UoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50ZWQhJyk7XG4gIH1cblxuICBmaXgoKSB7XG4gICAgLy8gcmV0dXJuIHN0cmluZyBmb3IgbWFudWFsIGZpeGVzLlxuICAgIHRocm93IG5ldyBFcnJvcignTm90IEltcGxlbWVudGVkIScpO1xuICB9XG59XG5cbmNsYXNzIERvY3RvciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY2hlY2tzID0gW107XG4gICAgdGhpcy5jaGVja09wdGlvbmFscyA9IFtdO1xuICAgIHRoaXMudG9GaXggPSBbXTtcbiAgICB0aGlzLnRvRml4T3B0aW9uYWxzID0gW107XG4gIH1cblxuICByZWdpc3RlcihjaGVja3MpIHtcbiAgICBjaGVja3MgPSBBcnJheS5pc0FycmF5KGNoZWNrcykgPyBjaGVja3MgOiBbY2hlY2tzXTtcbiAgICB0aGlzLmNoZWNrcyA9IHRoaXMuY2hlY2tzLmNvbmNhdChjaGVja3MpO1xuICB9XG5cbiAgYXN5bmMgZGlhZ25vc2UoKSB7XG4gICAgbG9nLmluZm8oYCMjIyBEaWFnbm9zdGljIGZvciAkeyduZWNlc3NhcnknLmdyZWVufSBkZXBlbmRlbmNpZXMgc3RhcnRpbmcgIyMjYCk7XG4gICAgdGhpcy50b0ZpeCA9IFtdO1xuICAgIGZvciAoY29uc3QgY2hlY2sgb2YgdGhpcy5jaGVja3MpIHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoZWNrLmRpYWdub3NlKCk7XG4gICAgICBpZiAocmVzLm9wdGlvbmFsKSB7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25hbHMucHVzaChjaGVjayk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5kaWFnbm9zdGljUmVzdWx0TWVzc2FnZShyZXMsIHRoaXMudG9GaXgsIGNoZWNrKTtcbiAgICB9XG4gICAgbG9nLmluZm8oXG4gICAgICBgIyMjIERpYWdub3N0aWMgZm9yIG5lY2Vzc2FyeSBkZXBlbmRlbmNpZXMgY29tcGxldGVkLCAke2F3YWl0IHRoaXMuZml4TWVzc2FnZShcbiAgICAgICAgdGhpcy50b0ZpeC5sZW5ndGhcbiAgICAgICl9LiAjIyNgXG4gICAgKTtcbiAgICBsb2cuaW5mbygnJyk7XG5cbiAgICBsb2cuaW5mbyhgIyMjIERpYWdub3N0aWMgZm9yICR7J29wdGlvbmFsJy55ZWxsb3d9IGRlcGVuZGVuY2llcyBzdGFydGluZyAjIyNgKTtcbiAgICB0aGlzLnRvRml4T3B0aW9uYWxzID0gW107XG4gICAgZm9yIChjb25zdCBjaGVja09wdGlvbmFsIG9mIHRoaXMuY2hlY2tPcHRpb25hbHMpIHtcbiAgICAgIGF3YWl0IHRoaXMuZGlhZ25vc3RpY1Jlc3VsdE1lc3NhZ2UoXG4gICAgICAgIGF3YWl0IGNoZWNrT3B0aW9uYWwuZGlhZ25vc2UoKSxcbiAgICAgICAgdGhpcy50b0ZpeE9wdGlvbmFscyxcbiAgICAgICAgY2hlY2tPcHRpb25hbFxuICAgICAgKTtcbiAgICB9XG4gICAgbG9nLmluZm8oXG4gICAgICBgIyMjIERpYWdub3N0aWMgZm9yIG9wdGlvbmFsIGRlcGVuZGVuY2llcyBjb21wbGV0ZWQsICR7YXdhaXQgdGhpcy5maXhNZXNzYWdlKFxuICAgICAgICB0aGlzLnRvRml4T3B0aW9uYWxzLmxlbmd0aCxcbiAgICAgICAgdHJ1ZVxuICAgICAgKX0uICMjI2BcbiAgICApO1xuICAgIGxvZy5pbmZvKCcnKTtcbiAgfVxuXG4gIGFzeW5jIHJlcG9ydE1hbnVhbEZpeGVzKGZpeCwgZml4T3B0aW9hbCkge1xuICAgIGNvbnN0IG1hbnVhbEZpeGVzID0gXy5maWx0ZXIoZml4LCAoZikgPT4gIWY/LmNoZWNrPy5hdXRvZml4KTtcbiAgICBjb25zdCBtYW51YWxGaXhlc09wdGlvbmFsID0gXy5maWx0ZXIoZml4T3B0aW9hbCwgKGYpID0+ICFmPy5jaGVjaz8uYXV0b2ZpeCk7XG5cbiAgICBpZiAobWFudWFsRml4ZXMubGVuZ3RoID4gMCkge1xuICAgICAgbG9nLmluZm8oJyMjIyBNYW51YWwgRml4ZXMgTmVlZGVkICMjIycpO1xuICAgICAgbG9nLmluZm8oJ1RoZSBjb25maWd1cmF0aW9uIGNhbm5vdCBiZSBhdXRvbWF0aWNhbGx5IGZpeGVkLCBwbGVhc2UgZG8gdGhlIGZvbGxvd2luZyBmaXJzdDonKTtcbiAgICAgIC8vIGZvciBtYW51YWwgZml4ZXMsIHRoZSBmaXggbWV0aG9kIGFsd2F5cyByZXR1cm4gYSBzdHJpbmdcbiAgICAgIGNvbnN0IGZpeE1lc3NhZ2VzID0gW107XG4gICAgICBmb3IgKGNvbnN0IGYgb2YgbWFudWFsRml4ZXMpIHtcbiAgICAgICAgZml4TWVzc2FnZXMucHVzaChhd2FpdCBmLmNoZWNrLmZpeCgpKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgbSBvZiBfLnVuaXEoZml4TWVzc2FnZXMpKSB7XG4gICAgICAgIGxvZy53YXJuKGAgXFx1Mjc5QyAke219YCk7XG4gICAgICB9XG4gICAgICBsb2cuaW5mbygnJyk7XG4gICAgfVxuICAgIGlmIChtYW51YWxGaXhlc09wdGlvbmFsLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZy5pbmZvKCcjIyMgT3B0aW9uYWwgTWFudWFsIEZpeGVzICMjIycpO1xuICAgICAgbG9nLmluZm8oJ1RoZSBjb25maWd1cmF0aW9uIGNhbiBpbnN0YWxsIG9wdGlvbmFsbHkuIFBsZWFzZSBkbyB0aGUgZm9sbG93aW5nIG1hbnVhbGx5OicpO1xuICAgICAgLy8gZm9yIG1hbnVhbCBmaXhlcywgdGhlIGZpeCBtZXRob2QgYWx3YXlzIHJldHVybiBhIHN0cmluZ1xuICAgICAgY29uc3QgZml4TWVzc2FnZXMgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgZiBvZiBtYW51YWxGaXhlc09wdGlvbmFsKSB7XG4gICAgICAgIGZpeE1lc3NhZ2VzLnB1c2goYXdhaXQgZi5jaGVjay5maXgoKSk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IG0gb2YgXy51bmlxKGZpeE1lc3NhZ2VzKSkge1xuICAgICAgICBsb2cud2FybihgIFxcdTI3OUMgJHttfWApO1xuICAgICAgfVxuICAgICAgbG9nLmluZm8oJycpO1xuICAgIH1cblxuICAgIGlmIChtYW51YWxGaXhlcy5sZW5ndGggPiAwIHx8IG1hbnVhbEZpeGVzT3B0aW9uYWwubGVuZ3RoID4gMCkge1xuICAgICAgbG9nLmluZm8oJyMjIycpO1xuICAgICAgbG9nLmluZm8oJycpO1xuICAgICAgbG9nLmluZm8oJ0J5ZSEgUnVuIGFwcGl1bS1kb2N0b3IgYWdhaW4gd2hlbiBhbGwgbWFudWFsIGZpeGVzIGhhdmUgYmVlbiBhcHBsaWVkIScpO1xuICAgICAgbG9nLmluZm8oJycpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGFzeW5jIHJ1bkF1dG9GaXgoZikge1xuICAgIGxvZy5pbmZvKGAjIyMgRml4aW5nOiAke2YuZXJyb3J9ICMjI2ApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmLmNoZWNrLmZpeCgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEZpeFNraXBwZWRFcnJvcikge1xuICAgICAgICBsb2cuaW5mbyhgIyMjIFNraXBwZWQgZml4ICMjI2ApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cud2FybihgJHtlcnJ9YC5yZXBsYWNlKC9cXG4kL2csICcnKSk7XG4gICAgICAgIGxvZy5pbmZvKGAjIyMgRml4IGRpZCBub3Qgc3VjY2VlZCAjIyNgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2cuaW5mbygnQ2hlY2tpbmcgaWYgdGhpcyB3YXMgZml4ZWQ6Jyk7XG4gICAgbGV0IHJlcyA9IGF3YWl0IGYuY2hlY2suZGlhZ25vc2UoKTtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICBmLmZpeGVkID0gdHJ1ZTtcbiAgICAgIGxvZy5pbmZvKGAgJHsnXFx1MjcxNCcuZ3JlZW59ICR7cmVzLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuaW5mbyhgIyMjIEZpeCB3YXMgc3VjY2Vzc2Z1bGx5IGFwcGxpZWQgIyMjYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5pbmZvKGAgJHsnXFx1MjcxNicucmVkfSAke3Jlcy5tZXNzYWdlfWApO1xuICAgICAgbG9nLmluZm8oYCMjIyBGaXggd2FzIGFwcGxpZWQgYnV0IGlzc3VlIHJlbWFpbnMgIyMjYCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcnVuQXV0b0ZpeGVzKCkge1xuICAgIGxldCBhdXRvRml4ZXMgPSBfLmZpbHRlcih0aGlzLnRvRml4LCAoZikgPT4gZj8uY2hlY2s/LmF1dG9maXgpO1xuICAgIGZvciAobGV0IGYgb2YgYXV0b0ZpeGVzKSB7XG4gICAgICBhd2FpdCB0aGlzLnJ1bkF1dG9GaXgoZik7XG4gICAgICBsb2cuaW5mbygnJyk7XG4gICAgfVxuICAgIGlmIChfLmZpbmQoYXV0b0ZpeGVzLCAoZikgPT4gIWYuZml4ZWQpKSB7XG4gICAgICAvLyBhIGZldyBpc3N1ZXMgcmVtYWluLlxuICAgICAgbG9nLmluZm8oJ0J5ZSEgQSBmZXcgaXNzdWVzIHJlbWFpbiwgZml4IG1hbnVhbGx5IGFuZC9vciByZXJ1biBhcHBpdW0tZG9jdG9yIScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBub3RoaW5nIGxlZnQgdG8gZml4LlxuICAgICAgbG9nLmluZm8oJ0J5ZSEgQWxsIGlzc3VlcyBoYXZlIGJlZW4gZml4ZWQhJyk7XG4gICAgfVxuICAgIGxvZy5pbmZvKCcnKTtcbiAgfVxuXG4gIGFzeW5jIHJ1bigpIHtcbiAgICBsb2cuaW5mbyhgQXBwaXVtIERvY3RvciB2LiR7dmVyc2lvbn1gKTtcbiAgICBhd2FpdCB0aGlzLmRpYWdub3NlKCk7XG4gICAgaWYgKGF3YWl0IHRoaXMucmVwb3J0U3VjY2Vzcyh0aGlzLnRvRml4Lmxlbmd0aCwgdGhpcy50b0ZpeE9wdGlvbmFscy5sZW5ndGgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChhd2FpdCB0aGlzLnJlcG9ydE1hbnVhbEZpeGVzKHRoaXMudG9GaXgsIHRoaXMudG9GaXhPcHRpb25hbHMpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGF3YWl0IHRoaXMucnVuQXV0b0ZpeGVzKCk7XG4gIH1cblxuICAvLy8vIGdlbmVyYXRpbmcgbWVzc2FnZXNcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlcXVpcmUtYXdhaXRcbiAgYXN5bmMgZGlhZ25vc3RpY1Jlc3VsdE1lc3NhZ2UocmVzdWx0LCB0b0ZpeExpc3QsIGNoZWNrKSB7XG4gICAgaWYgKHJlc3VsdC5vaykge1xuICAgICAgbG9nLmluZm8oYCAkeydcXHUyNzE0Jy5ncmVlbn0gJHtyZXN1bHQubWVzc2FnZX1gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gcmVzdWx0Lm9wdGlvbmFsXG4gICAgICAgID8gYCAkeydcXHUyNzE2Jy55ZWxsb3d9ICR7cmVzdWx0Lm1lc3NhZ2V9YFxuICAgICAgICA6IGAgJHsnXFx1MjcxNicucmVkfSAke3Jlc3VsdC5tZXNzYWdlfWA7XG4gICAgICBsb2cud2FybihlcnJvck1lc3NhZ2UpO1xuICAgICAgdG9GaXhMaXN0LnB1c2goe1xuICAgICAgICBlcnJvcjogZXJyb3JNZXNzYWdlLFxuICAgICAgICBjaGVjayxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZXF1aXJlLWF3YWl0XG4gIGFzeW5jIGZpeE1lc3NhZ2UobGVuZ3RoLCBvcHRpb25hbCA9IGZhbHNlKSB7XG4gICAgbGV0IG1lc3NhZ2U7XG4gICAgc3dpdGNoIChsZW5ndGgpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgbWVzc2FnZSA9ICdubyBmaXgnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgbWVzc2FnZSA9ICdvbmUgZml4JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBtZXNzYWdlID0gYCR7bGVuZ3RofSBmaXhlc2A7XG4gICAgfVxuICAgIHJldHVybiBgJHttZXNzYWdlfSAke29wdGlvbmFsID8gJ3Bvc3NpYmxlJyA6ICduZWVkZWQnfWA7XG4gIH1cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlcXVpcmUtYXdhaXRcbiAgYXN5bmMgcmVwb3J0U3VjY2VzcyhsZW5ndGgsIGxlbmd0aE9wdGlvbmFsKSB7XG4gICAgaWYgKGxlbmd0aCA9PT0gMCAmJiBsZW5ndGhPcHRpb25hbCA9PT0gMCkge1xuICAgICAgbG9nLmluZm8oJ0V2ZXJ5dGhpbmcgbG9va3MgZ29vZCwgYnllIScpO1xuICAgICAgbG9nLmluZm8oJycpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHtEb2N0b3IsIERvY3RvckNoZWNrLCBGaXhTa2lwcGVkRXJyb3J9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU07RUFBQ0E7QUFBRCxJQUFZQyxXQUFBLENBQUdDLG1CQUFILENBQXVCQyxTQUF2QixDQUFsQjs7QUFFQSxNQUFNQyxlQUFOLFNBQThCQyxLQUE5QixDQUFvQzs7OztBQUVwQyxNQUFNQyxXQUFOLENBQWtCO0VBQ2hCQyxXQUFXLENBQUNDLElBQUksR0FBRyxFQUFSLEVBQVk7SUFDckIsS0FBS0MsT0FBTCxHQUFlLENBQUMsQ0FBQ0QsSUFBSSxDQUFDQyxPQUF0QjtFQUNEOztFQUVEQyxRQUFRLEdBQUc7SUFDVCxNQUFNLElBQUlMLEtBQUosQ0FBVSxrQkFBVixDQUFOO0VBQ0Q7O0VBRURNLEdBQUcsR0FBRztJQUVKLE1BQU0s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