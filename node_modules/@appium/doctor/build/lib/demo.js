"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.FileCheck = exports.DirCheck = void 0;

require("source-map-support/register");

var _utils = require("./utils");

var _support = require("@appium/support");

var _teen_process = require("teen_process");

var _doctor = require("./doctor");

var _logger = _interopRequireDefault(require("./logger"));

var _prompt = require("./prompt");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let checks = [];

class DirCheck extends _doctor.DoctorCheck {
  constructor(path) {
    super({
      autofix: false
    });
    this.path = path;
  }

  async diagnose() {
    if (!(await _support.fs.exists(this.path))) {
      return (0, _utils.nok)(`Could NOT find directory at '${this.path}'!`);
    }

    let stats = await _support.fs.lstat(this.path);
    return stats.isDirectory() ? (0, _utils.ok)(`Found directory at: ${this.path}`) : (0, _utils.nok)(`'${this.path}' is NOT a directory!`);
  }

  async fix() {
    return `Manually create a directory at: ${this.path}`;
  }

}

exports.DirCheck = DirCheck;
checks.push(new DirCheck('/tmp/appium-doctor'));
checks.push(new DirCheck('/tmp/appium-doctor/demo'));

class FileCheck extends _doctor.DoctorCheck {
  constructor(path) {
    super({
      autofix: true
    });
    this.path = path;
  }

  async diagnose() {
    return (await _support.fs.exists(this.path)) ? (0, _utils.ok)(`Found file at: ${this.path}`) : (0, _utils.nok)(`Could NOT find file at '${this.path}'!`);
  }

  async fix() {
    _logger.default.info(`The following command need be executed: touch '${this.path}'`);

    let yesno = await (0, _prompt.fixIt)();

    if (yesno === 'yes') {
      await (0, _teen_process.exec)('touch', [this.path]);
    } else {
      _logger.default.info(`Skipping you will need to touch '${this.path}' manually.`);

      throw new _doctor.FixSkippedError('bbb');
    }
  }

}

exports.FileCheck = FileCheck;
checks.push(new FileCheck('/tmp/appium-doctor/demo/apple.fruit'));
checks.push(new FileCheck('/tmp/appium-doctor/demo/pear.fruit'));
checks.push(new FileCheck('/tmp/appium-doctor/demo/orange.fruit'));
var _default = checks;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjaGVja3MiLCJEaXJDaGVjayIsIkRvY3RvckNoZWNrIiwiY29uc3RydWN0b3IiLCJwYXRoIiwiYXV0b2ZpeCIsImRpYWdub3NlIiwiZnMiLCJleGlzdHMiLCJub2siLCJzdGF0cyIsImxzdGF0IiwiaXNEaXJlY3RvcnkiLCJvayIsImZpeCIsInB1c2giLCJGaWxlQ2hlY2siLCJsb2ciLCJpbmZvIiwieWVzbm8iLCJmaXhJdCIsImV4ZWMiLCJGaXhTa2lwcGVkRXJyb3IiXSwic291cmNlcyI6WyIuLi8uLi9saWIvZGVtby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBkZW1vIHJ1bGUgdG8gdGVzdCB0aGUgZ3VpXG5cbmltcG9ydCB7b2ssIG5va30gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQge2ZzfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHtleGVjfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHtEb2N0b3JDaGVjaywgRml4U2tpcHBlZEVycm9yfSBmcm9tICcuL2RvY3Rvcic7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7Zml4SXR9IGZyb20gJy4vcHJvbXB0JztcblxubGV0IGNoZWNrcyA9IFtdO1xuXG5jbGFzcyBEaXJDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgY29uc3RydWN0b3IocGF0aCkge1xuICAgIHN1cGVyKHthdXRvZml4OiBmYWxzZX0pO1xuICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gIH1cblxuICBhc3luYyBkaWFnbm9zZSgpIHtcbiAgICBpZiAoIShhd2FpdCBmcy5leGlzdHModGhpcy5wYXRoKSkpIHtcbiAgICAgIHJldHVybiBub2soYENvdWxkIE5PVCBmaW5kIGRpcmVjdG9yeSBhdCAnJHt0aGlzLnBhdGh9JyFgKTtcbiAgICB9XG4gICAgbGV0IHN0YXRzID0gYXdhaXQgZnMubHN0YXQodGhpcy5wYXRoKTtcbiAgICByZXR1cm4gc3RhdHMuaXNEaXJlY3RvcnkoKVxuICAgICAgPyBvayhgRm91bmQgZGlyZWN0b3J5IGF0OiAke3RoaXMucGF0aH1gKVxuICAgICAgOiBub2soYCcke3RoaXMucGF0aH0nIGlzIE5PVCBhIGRpcmVjdG9yeSFgKTtcbiAgfVxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVxdWlyZS1hd2FpdFxuICBhc3luYyBmaXgoKSB7XG4gICAgcmV0dXJuIGBNYW51YWxseSBjcmVhdGUgYSBkaXJlY3RvcnkgYXQ6ICR7dGhpcy5wYXRofWA7XG4gIH1cbn1cblxuY2hlY2tzLnB1c2gobmV3IERpckNoZWNrKCcvdG1wL2FwcGl1bS1kb2N0b3InKSk7XG5jaGVja3MucHVzaChuZXcgRGlyQ2hlY2soJy90bXAvYXBwaXVtLWRvY3Rvci9kZW1vJykpO1xuXG5jbGFzcyBGaWxlQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGNvbnN0cnVjdG9yKHBhdGgpIHtcbiAgICBzdXBlcih7YXV0b2ZpeDogdHJ1ZX0pO1xuICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gIH1cblxuICBhc3luYyBkaWFnbm9zZSgpIHtcbiAgICByZXR1cm4gKGF3YWl0IGZzLmV4aXN0cyh0aGlzLnBhdGgpKVxuICAgICAgPyBvayhgRm91bmQgZmlsZSBhdDogJHt0aGlzLnBhdGh9YClcbiAgICAgIDogbm9rKGBDb3VsZCBOT1QgZmluZCBmaWxlIGF0ICcke3RoaXMucGF0aH0nIWApO1xuICB9XG5cbiAgYXN5bmMgZml4KCkge1xuICAgIGxvZy5pbmZvKGBUaGUgZm9sbG93aW5nIGNvbW1hbmQgbmVlZCBiZSBleGVjdXRlZDogdG91Y2ggJyR7dGhpcy5wYXRofSdgKTtcbiAgICBsZXQgeWVzbm8gPSBhd2FpdCBmaXhJdCgpO1xuICAgIGlmICh5ZXNubyA9PT0gJ3llcycpIHtcbiAgICAgIGF3YWl0IGV4ZWMoJ3RvdWNoJywgW3RoaXMucGF0aF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuaW5mbyhgU2tpcHBpbmcgeW91IHdpbGwgbmVlZCB0byB0b3VjaCAnJHt0aGlzLnBhdGh9JyBtYW51YWxseS5gKTtcbiAgICAgIHRocm93IG5ldyBGaXhTa2lwcGVkRXJyb3IoJ2JiYicpO1xuICAgIH1cbiAgfVxufVxuXG5jaGVja3MucHVzaChuZXcgRmlsZUNoZWNrKCcvdG1wL2FwcGl1bS1kb2N0b3IvZGVtby9hcHBsZS5mcnVpdCcpKTtcbmNoZWNrcy5wdXNoKG5ldyBGaWxlQ2hlY2soJy90bXAvYXBwaXVtLWRvY3Rvci9kZW1vL3BlYXIuZnJ1aXQnKSk7XG5jaGVja3MucHVzaChuZXcgRmlsZUNoZWNrKCcvdG1wL2FwcGl1bS1kb2N0b3IvZGVtby9vcmFuZ2UuZnJ1aXQnKSk7XG5cbmV4cG9ydCB7RGlyQ2hlY2ssIEZpbGVDaGVja307XG5leHBvcnQgZGVmYXVsdCBjaGVja3M7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsSUFBSUEsTUFBTSxHQUFHLEVBQWI7O0FBRUEsTUFBTUMsUUFBTixTQUF1QkMsbUJBQXZCLENBQW1DO0VBQ2pDQyxXQUFXLENBQUNDLElBQUQsRUFBTztJQUNoQixNQUFNO01BQUNDLE9BQU8sRUFBRTtJQUFWLENBQU47SUFDQSxLQUFLRCxJQUFMLEdBQVlBLElBQVo7RUFDRDs7RUFFYSxNQUFSRSxRQUFRLEdBQUc7SUFDZixJQUFJLEVBQUUsTUFBTUMsV0FBQSxDQUFHQyxNQUFILENBQVUsS0FBS0osSUFBZixDQUFSLENBQUosRUFBbUM7TUFDakMsT0FBTyxJQUFBSyxVQUFBLEVBQUssZ0NBQStCLEtBQUtMLElBQUssSUFBOUMsQ0FBUDtJQUNEOztJQUNELElBQUlNLEtBQUssR0FBRyxNQUFNSCxXQUFBLENBQUdJLEtBQUgsQ0FBUyxLQUFLUCxJQUFkLENBQWxCO0lBQ0EsT0FBT00sS0FBSyxDQUFDRSxXQUFOLEtBQ0gsSUFBQUMsU0FBQSxFQUFJLHVCQUFzQixLQUFLVCxJQUFLLEVBQXBDLENBREcsR0FFSCxJQUFBSyxVQUFBLEVBQUssSUFBRyxLQUFLTCxJQUFLLHVCQUFsQixDQUZKO0VBR0Q7O0VBRVEsTUFBSFUsR0FBRyxHQUFHO0lBQ1YsT0FBUSxtQ0FBa0MsS0FBS1YsSUFBSyxFQUFwRDtFQUNEOztBQWxCZ0M7OztBQXFCbkNKLE1BQU0sQ0FBQ2UsSUFBUCxDQUFZLElBQUlkLFFBQUosQ0FBYSxvQkFBYixDQUFaO0FBQ0FELE1BQU0sQ0FBQ2UsSUFBUCxDQUFZLElBQUlkLFFBQUosQ0FBYSx5QkFBYixDQUFaOztBQUVBLE1BQU1lLFNBQU4sU0FBd0JkLG1CQUF4QixDQUFvQztFQUNsQ0MsV0FBVyxDQUFDQyxJQUFELEVBQU87SUFDaEIsTUFBTTtNQUFDQyxPQUFPLEVBQUU7SUFBVixDQUFOO0lBQ0EsS0FBS0QsSUFBTCxHQUFZQSxJQUFaO0VBQ0Q7O0VBRWEsTUFBUkUsUUFBUSxHQUFHO0lBQ2YsT0FBTyxDQUFDLE1BQU1DLFdBQUEsQ0FBR0MsTUFBSCxDQUFVLEtBQUtKLElBQWYsQ0FBUCxJQUNILElBQUFTLFNBQUEsRUFBSSxrQkFBaUIsS0FBS1QsSUFBSyxFQUEvQixDQURHLEdBRUgsSUFBQUssVUFBQSxFQUFLLDJCQUEwQixLQUFLTCxJQUFLLElBQXpDLENBRko7RUFHRDs7RUFFUSxNQUFIVSxHQUFHLEdBQUc7SUFDVkcsZUFBQSxDQUFJQyxJQUFKLENBQVUsa0RBQWlELEtBQUtkLElBQUssR0FBckU7O0lBQ0EsSUFBSWUsS0FBSyxHQUFHLE1BQU0sSUFBQUMsYUFBQSxHQUFsQjs7SUFDQSxJQUFJRCxLQUFLLEtBQUssS0FBZCxFQUFxQjtNQUNuQixNQUFNLElBQUFFLGtCQUFBLEVBQUssT0FBTCxFQUFjLENBQUMsS0FBS2pCLElBQU4sQ0FBZCxDQUFOO0lBQ0QsQ0FGRCxNQUVPO01BQ0xhLGVBQUEsQ0FBSUMsSUFBSixDQUFVLG9DQUFtQyxLQUFLZCxJQUFLLGFBQXZEOztNQUNBLE1BQU0sSUFBSWtCLHVCQUFKLENBQW9CLEtBQXBCLENBQU47SUFDRDtFQUNGOztBQXJCaUM7OztBQXdCcEN0QixNQUFNLENBQUNlLElBQVAsQ0FBWSxJQUFJQyxTQUFKLENBQWMscUNBQWQsQ0FBWjtBQUNBaEIsTUFBTSxDQUFDZSxJQUFQLENBQVksSUFBSUMsU0FBSixDQUFjLG9DQUFkLENBQVo7QUFDQWhCLE1BQU0sQ0FBQ2UsSUFBUCxDQUFZLElBQUlDLFNBQUosQ0FBYyxzQ0FBZCxDQUFaO2VBR2VoQixNIn0=