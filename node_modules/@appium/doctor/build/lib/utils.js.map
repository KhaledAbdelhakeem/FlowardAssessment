{"version":3,"file":"utils.js","names":["ok","message","optional","nok","okOptional","nokOptional","inquirer","prompt","B","promisify","question","cb","_inquirer","resp","actualLog","configureBinaryLog","opts","log","unwrap","level","prefix","msg","l","levels","isFunction","onLogMessage","debug","resetLog","resolveExecutablePath","cmd","executablePath","fs","which","exists","err","test","warn","getNpmPackageInfo","packageName","npmPath","system","isWindows","process","env","PATH","pJson","stdout","exec","JSON","parse","dependencies","version","path"],"sources":["../../lib/utils.js"],"sourcesContent":["import B from 'bluebird';\nimport _inquirer from 'inquirer';\nimport log from '../lib/logger';\nimport {fs, system} from '@appium/support';\nimport {exec} from 'teen_process';\nimport {isFunction} from 'lodash';\n\nfunction ok(message) {\n  return {ok: true, optional: false, message};\n}\nfunction nok(message) {\n  return {ok: false, optional: false, message};\n}\nfunction okOptional(message) {\n  return {ok: true, optional: true, message};\n}\nfunction nokOptional(message) {\n  return {ok: false, optional: true, message};\n}\n\nconst inquirer = {\n  prompt: B.promisify(function (question, cb) {\n    // eslint-disable-line promise/prefer-await-to-callbacks\n    _inquirer.prompt(question, function (resp) {\n      cb(null, resp);\n    }); // eslint-disable-line promise/prefer-await-to-callbacks\n  }),\n};\n\nlet actualLog;\n\nfunction configureBinaryLog(opts) {\n  actualLog = log.unwrap().log;\n  log.unwrap().log = function (level, prefix, msg) {\n    let l = this.levels[level];\n    if (l < this.levels[this.level]) return; // eslint-disable-line curly\n    actualLog(level, prefix, msg);\n\n    if (isFunction(opts.onLogMessage)) {\n      opts.onLogMessage(level, prefix, msg);\n    }\n  };\n  log.level = opts.debug ? 'debug' : 'info';\n}\n\n/**\n * If {@link configureBinaryLog} was called, this will restore the original `log` function.\n */\nfunction resetLog() {\n  if (actualLog) {\n    log.unwrap().log = actualLog;\n  }\n}\n\n/**\n * Return an executable path of cmd\n *\n * @param {string} cmd Standard output by command\n * @return {?string} The full path of cmd. `null` if the cmd is not found.\n */\nasync function resolveExecutablePath(cmd) {\n  let executablePath;\n  try {\n    executablePath = await fs.which(cmd);\n    if (executablePath && (await fs.exists(executablePath))) {\n      return executablePath;\n    }\n  } catch (err) {\n    if (/not found/gi.test(err.message)) {\n      log.debug(err);\n    } else {\n      log.warn(err);\n    }\n  }\n  log.debug(`No executable path of '${cmd}'.`);\n  if (executablePath) {\n    log.debug(`Does '${executablePath}' exist?`);\n  }\n  return null;\n}\n\n/**\n * @typedef NpmPackageInfo\n * @property {string} version - version\n * @property {string} path - A path to npm root\n */\n/**\n * Returns the path and version of given package name\n * @param {string} packageName A package name to get path and version data\n * @return {?NpmPackageInfo}\n */\nasync function getNpmPackageInfo(packageName) {\n  const npmPath = await resolveExecutablePath(`npm${system.isWindows() ? `.cmd` : ''}`);\n  if (!npmPath) {\n    return nokOptional(`'npm' binary not found in PATH: ${process.env.PATH}`);\n  }\n\n  let pJson = {};\n  try {\n    const {stdout} = await exec(npmPath, ['list', '-g', '-l', '-j', packageName]);\n    pJson = JSON.parse(stdout);\n  } catch (err) {\n    log.debug(err);\n    return null;\n  }\n\n  if (pJson.dependencies && pJson.dependencies[packageName]) {\n    return {version: pJson.dependencies[packageName].version, path: pJson.path};\n  }\n\n  return null;\n}\n\nexport {\n  ok,\n  nok,\n  okOptional,\n  nokOptional,\n  inquirer,\n  configureBinaryLog,\n  resolveExecutablePath,\n  getNpmPackageInfo,\n  resetLog,\n};\n"],"mappings":"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"}