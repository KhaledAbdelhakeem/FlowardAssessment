{"version":3,"file":"general.js","names":["checks","NodeBinaryCheck","DoctorCheck","diagnose","nodePath","NodeDetector","detect","ok","nok","fix","bold","push","REQUIRED_NODE_VERSION","NodeVersionCheck","stdout","exec","versionString","replace","trim","util","compareVersions","OptionalFfmpegCommandCheck","ffmpegPath","resolveExecutablePath","okOptional","split","EOL","nokOptional","OptionalMjpegConsumerCommandCheck","packageName","packageInfo","getNpmPackageInfo","path","version"],"sources":["../../lib/general.js"],"sourcesContent":["import {ok, nok, okOptional, nokOptional, resolveExecutablePath, getNpmPackageInfo} from './utils';\nimport {exec} from 'teen_process';\nimport {DoctorCheck} from './doctor';\nimport NodeDetector from './node-detector';\nimport {util} from '@appium/support';\nimport {EOL} from 'os';\nimport '@colors/colors';\n\nlet checks = [];\n\n// Node Binary\nclass NodeBinaryCheck extends DoctorCheck {\n  async diagnose() {\n    let nodePath = await NodeDetector.detect();\n    return nodePath\n      ? ok(`The Node.js binary was found at: ${nodePath}`)\n      : nok('The Node.js binary was NOT found!');\n  }\n\n  fix() {\n    return `Manually setup ${'Node.js'.bold}.`;\n  }\n}\nchecks.push(new NodeBinaryCheck());\n\nconst REQUIRED_NODE_VERSION = '10.0.0';\n\n// Node version\nclass NodeVersionCheck extends DoctorCheck {\n  async diagnose() {\n    let nodePath = await NodeDetector.detect();\n    if (!nodePath) {\n      return nok('Node is not installed, so no version to check!');\n    }\n    let {stdout} = await exec(nodePath, ['--version']);\n    let versionString = stdout.replace('v', '').trim();\n    try {\n      return util.compareVersions(REQUIRED_NODE_VERSION, '<=', versionString)\n        ? ok(`Node version is ${versionString}`)\n        : nok(`Node version should be at least ${REQUIRED_NODE_VERSION}!`);\n    } catch {\n      return nok(`Unable to find node version (version = '${versionString}')`);\n    }\n  }\n\n  fix() {\n    return `Manually upgrade ${'Node.js'.bold}.`;\n  }\n}\nchecks.push(new NodeVersionCheck());\n\nclass OptionalFfmpegCommandCheck extends DoctorCheck {\n  async diagnose() {\n    const ffmpegPath = await resolveExecutablePath('ffmpeg');\n    return ffmpegPath\n      ? okOptional(\n          `ffmpeg is installed at: ${ffmpegPath}. ${\n            (await exec('ffmpeg', ['-version'])).stdout.split(EOL)[0]\n          }`\n        )\n      : nokOptional('ffmpeg cannot be found');\n  }\n  // eslint-disable-next-line require-await\n  async fix() {\n    return `${\n      'ffmpeg'.bold\n    } is needed to record screen features. Please read https://www.ffmpeg.org/ to install it`;\n  }\n}\nchecks.push(new OptionalFfmpegCommandCheck());\n\nclass OptionalMjpegConsumerCommandCheck extends DoctorCheck {\n  async diagnose() {\n    const packageName = 'mjpeg-consumer';\n    const packageInfo = await getNpmPackageInfo(packageName);\n\n    if (packageInfo) {\n      return okOptional(\n        `${packageName} is installed at: ${packageInfo.path}. Installed version is: ${packageInfo.version}`\n      );\n    }\n    return nokOptional(`${packageName} cannot be found.`);\n  }\n  // eslint-disable-next-line require-await\n  async fix() {\n    return `${\n      'mjpeg-consumer'.bold\n    } module is required to use MJPEG-over-HTTP features. Please install it with 'npm i -g mjpeg-consumer'.`;\n  }\n}\nchecks.push(new OptionalMjpegConsumerCommandCheck());\n\nexport {\n  NodeBinaryCheck,\n  NodeVersionCheck,\n  OptionalFfmpegCommandCheck,\n  OptionalMjpegConsumerCommandCheck,\n};\nexport default checks;\n"],"mappings":"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"}