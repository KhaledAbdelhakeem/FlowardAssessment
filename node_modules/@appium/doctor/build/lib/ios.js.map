{"version":3,"file":"ios.js","names":["checks","fixes","XcodeCheck","DoctorCheck","diagnose","xcodePath","exec","err","nok","stdout","replace","fs","exists","ok","fix","bold","push","XcodeCmdLineToolsCheck","constructor","autofix","errMess","trim","log","debug","info","yesno","fixIt","FixSkippedError","DevToolsSecurityCheck","match","EnvVarAndPathCheck","OptionalLyftCommandCheck","lyftCmd","resolveExecutablePath","okOptional","nokOptional","OptionalIdbCommandCheck","fbIdbPath","fbCompanionIdbPath","idbReadmeURL","OptionalApplesimutilsCommandCheck","applesimutilsPath","OptionalIOSDeployCommandCheck","iosDeployPath"],"sources":["../../lib/ios.js"],"sourcesContent":["import {ok, nok, okOptional, nokOptional, resolveExecutablePath} from './utils'; // eslint-disable-line\nimport {fs} from '@appium/support';\nimport {exec} from 'teen_process';\nimport {DoctorCheck, FixSkippedError} from './doctor';\nimport log from './logger';\nimport {fixIt} from './prompt';\nimport EnvVarAndPathCheck from './env';\nimport '@colors/colors';\n\nlet checks = [];\nlet fixes = {};\n\n// Check for Xcode.\nclass XcodeCheck extends DoctorCheck {\n  async diagnose() {\n    let xcodePath;\n    try {\n      // https://github.com/appium/appium/issues/12093#issuecomment-459358120 can happen\n      await exec('xcrun', ['simctl', 'help']);\n    } catch (err) {\n      return nok('Error running xcrun simctl');\n    }\n    try {\n      const {stdout} = await exec('xcode-select', ['-p']);\n      xcodePath = (stdout || '').replace('\\n', '');\n    } catch (err) {\n      return nok('Xcode is NOT installed!');\n    }\n    return xcodePath && (await fs.exists(xcodePath))\n      ? ok(`Xcode is installed at: ${xcodePath}`)\n      : nok(`Xcode cannot be found at '${xcodePath}'!`);\n  }\n\n  // eslint-disable-next-line require-await\n  async fix() {\n    return `Manually install ${\n      'Xcode'.bold\n    }, and make sure 'xcode-select -p' command shows proper path like '/Applications/Xcode.app/Contents/Developer'`;\n  }\n}\nchecks.push(new XcodeCheck());\n\n// Check for Xcode Command Line Tools.\nclass XcodeCmdLineToolsCheck extends DoctorCheck {\n  constructor() {\n    super({autofix: true});\n  }\n\n  async diagnose() {\n    const errMess = 'Xcode Command Line Tools are NOT installed!';\n    try {\n      // https://stackoverflow.com/questions/15371925/how-to-check-if-command-line-tools-is-installed\n      const stdout = (await exec('xcode-select', ['-p'])).stdout;\n      return ok(`Xcode Command Line Tools are installed in: ${stdout.trim()}`);\n    } catch (err) {\n      log.debug(err);\n      return nok(errMess);\n    }\n  }\n\n  async fix() {\n    log.info(`The following command need be executed: xcode-select --install`);\n    let yesno = await fixIt();\n    if (yesno === 'yes') {\n      await exec('xcode-select', ['--install']);\n    } else {\n      log.info(`Skipping you will need to install ${'Xcode'.bold} manually.`);\n      throw new FixSkippedError();\n    }\n  }\n}\n\nchecks.push(new XcodeCmdLineToolsCheck());\n\n// Dev Tools Security\nclass DevToolsSecurityCheck extends DoctorCheck {\n  async diagnose() {\n    const errMess = 'DevToolsSecurity is NOT enabled!';\n    let stdout;\n    try {\n      stdout = (await exec('DevToolsSecurity', [])).stdout;\n    } catch (err) {\n      log.debug(err);\n      return nok(errMess);\n    }\n    return stdout && stdout.match(/enabled/) ? ok('DevToolsSecurity is enabled.') : nok(errMess);\n  }\n}\nchecks.push(new DevToolsSecurityCheck());\n\nchecks.push(new EnvVarAndPathCheck('HOME'));\n\nclass OptionalLyftCommandCheck extends DoctorCheck {\n  async diagnose() {\n    const lyftCmd = await resolveExecutablePath('set-simulator-location');\n    if (lyftCmd) {\n      return okOptional('set-simulator-location is installed');\n    }\n\n    return nokOptional('set-simulator-location is not installed');\n  }\n  // eslint-disable-next-line require-await\n  async fix() {\n    return (\n      `${'set-simulator-location'.bold} is needed to set location for Simulator. ` +\n      'Please read https://github.com/lyft/set-simulator-location to install it'\n    );\n  }\n}\nchecks.push(new OptionalLyftCommandCheck());\n\nclass OptionalIdbCommandCheck extends DoctorCheck {\n  async diagnose() {\n    const fbIdbPath = await resolveExecutablePath('idb');\n    const fbCompanionIdbPath = await resolveExecutablePath('idb_companion');\n    if (fbIdbPath && fbCompanionIdbPath) {\n      return okOptional('idb and idb_companion are installed');\n    }\n\n    if (!fbIdbPath && fbCompanionIdbPath) {\n      return nokOptional('idb is not installed');\n    } else if (fbIdbPath && !fbCompanionIdbPath) {\n      return nokOptional('idb_companion is not installed');\n    }\n    return nokOptional('idb and idb_companion are not installed');\n  }\n  // eslint-disable-next-line require-await\n  async fix() {\n    return `Why ${'idb'.bold} is needed and how to install it: ${\n      OptionalIdbCommandCheck.idbReadmeURL\n    }`;\n  }\n}\n// link to idb README.md\n// https://github.com/appium/appium-ios/blob/main/packages/idb/README.md\nOptionalIdbCommandCheck.idbReadmeURL = 'https://git.io/JnxQc';\nchecks.push(new OptionalIdbCommandCheck());\n\nclass OptionalApplesimutilsCommandCheck extends DoctorCheck {\n  async diagnose() {\n    const applesimutilsPath = await resolveExecutablePath('applesimutils');\n    return applesimutilsPath\n      ? okOptional(\n          `applesimutils is installed at: ${applesimutilsPath}. Installed versions are: ${(\n            await exec('brew', ['list', '--versions', 'applesimutils'])\n          ).stdout.trim()}`\n        )\n      : nokOptional('applesimutils cannot be found');\n  }\n\n  // eslint-disable-next-line require-await\n  async fix() {\n    return `Why ${\n      'applesimutils'.bold\n    } is needed and how to install it: http://appium.io/docs/en/drivers/ios-xcuitest/`;\n  }\n}\nchecks.push(new OptionalApplesimutilsCommandCheck());\n\nclass OptionalIOSDeployCommandCheck extends DoctorCheck {\n  async diagnose() {\n    const iosDeployPath = await resolveExecutablePath('ios-deploy');\n    return iosDeployPath\n      ? okOptional(\n          `ios-deploy is installed at: ${iosDeployPath}. Installed version is: ${(\n            await exec(iosDeployPath, ['-V'])\n          ).stdout.trim()}`\n        )\n      : nokOptional('ios-deploy cannot be found');\n  }\n\n  // eslint-disable-next-line require-await\n  async fix() {\n    return `${\n      'ios-deploy'.bold\n    } is used as a fallback command to install iOS applications to real device. Please read https://github.com/ios-control/ios-deploy/ to install it`;\n  }\n}\nchecks.push(new OptionalIOSDeployCommandCheck());\n\nexport {\n  fixes,\n  XcodeCheck,\n  XcodeCmdLineToolsCheck,\n  DevToolsSecurityCheck,\n  OptionalIdbCommandCheck,\n  OptionalApplesimutilsCommandCheck,\n  OptionalIOSDeployCommandCheck,\n  OptionalLyftCommandCheck,\n};\nexport default checks;\n"],"mappings":"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"}