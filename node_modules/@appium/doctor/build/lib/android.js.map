{"version":3,"file":"android.js","names":["checks","javaHome","system","isWindows","push","EnvVarAndPathCheck","JavaOnPathCheck","DoctorCheck","diagnose","process","env","JAVA_HOME","javaHomeBin","path","resolve","fs","exists","ok","nok","fix","AndroidToolCheck","constructor","tools","noBinaries","listOfTools","join","sdkRoot","getSdkRootFromEnv","log","info","binary","getAndroidBinaryPath","e","length","ANDROID_HOME","bold","OptionalAppBundleCheck","bundletoolPath","resolveExecutablePath","okOptional","nokOptional","OptionalGstreamerCheck","GSTREAMER_BINARY","GST_INSPECT_BINARY","gstreamerPath","gstInspectPath"],"sources":["../../lib/android.js"],"sourcesContent":["import {DoctorCheck} from './doctor';\nimport {ok, nok, okOptional, nokOptional, resolveExecutablePath} from './utils';\nimport {system, fs} from '@appium/support';\nimport path from 'path';\nimport EnvVarAndPathCheck from './env';\nimport '@colors/colors';\nimport {getAndroidBinaryPath, getSdkRootFromEnv} from 'appium-adb';\nimport log from './logger';\n\nlet checks = [];\n\nconst javaHome = system.isWindows() ? '%JAVA_HOME%' : '$JAVA_HOME';\n\nchecks.push(new EnvVarAndPathCheck('ANDROID_HOME'));\nchecks.push(new EnvVarAndPathCheck('JAVA_HOME'));\n\n// Check that the PATH includes the jdk's bin directory\nclass JavaOnPathCheck extends DoctorCheck {\n  async diagnose() {\n    if (process.env.JAVA_HOME) {\n      const javaHomeBin = path.resolve(process.env.JAVA_HOME, 'bin');\n      return (await fs.exists(javaHomeBin))\n        ? ok(`'bin' subfolder exists under '${process.env.JAVA_HOME}'`)\n        : nok(\n            `'bin' subfolder does not exist under '${process.env.JAVA_HOME}'. ` +\n              `Is ${javaHome} set to a proper value?`\n          );\n    }\n    return nok(\n      `Cannot check ${javaHome} requirements since the environment variable itself is not set`\n    );\n  }\n\n  fix() {\n    return `Set ${javaHome} environment variable to the root folder path of your local JDK installation`;\n  }\n}\n\n// Check tools\nclass AndroidToolCheck extends DoctorCheck {\n  constructor() {\n    super();\n    this.tools = ['adb', 'emulator', `apkanalyzer${system.isWindows() ? '.bat' : ''}`];\n    this.noBinaries = [];\n  }\n\n  async diagnose() {\n    const listOfTools = this.tools.join(', ');\n    const sdkRoot = getSdkRootFromEnv();\n    if (!sdkRoot) {\n      return nok(\n        `${listOfTools} could not be found because ANDROID_HOME or ANDROID_SDK_ROOT is NOT set!`\n      );\n    }\n\n    log.info(`   Checking ${listOfTools}`);\n\n    for (const binary of this.tools) {\n      try {\n        log.info(`     '${binary}' is in ${await getAndroidBinaryPath(binary)}`);\n      } catch (e) {\n        this.noBinaries.push(binary);\n      }\n    }\n\n    if (this.noBinaries.length > 0) {\n      return nok(`${this.noBinaries.join(', ')} could NOT be found in ${sdkRoot}!`);\n    }\n\n    return ok(`${listOfTools} exist: ${sdkRoot}`);\n  }\n\n  fix() {\n    if (typeof process.env.ANDROID_HOME === 'undefined') {\n      return `Manually configure ${'ANDROID_HOME'.bold} and run appium-doctor again.`;\n    }\n\n    return (\n      `Manually install ${this.noBinaries.join(', ').bold} and add it to ${'PATH'.bold}. ` +\n      'https://developer.android.com/studio#cmdline-tools and ' +\n      'https://developer.android.com/studio/intro/update#sdk-manager may help to setup.'\n    );\n  }\n}\nchecks.push(new AndroidToolCheck());\nchecks.push(new JavaOnPathCheck());\n\nclass OptionalAppBundleCheck extends DoctorCheck {\n  async diagnose() {\n    const bundletoolPath = await resolveExecutablePath('bundletool.jar');\n    return bundletoolPath\n      ? okOptional(`bundletool.jar is installed at: ${bundletoolPath}`)\n      : nokOptional('bundletool.jar cannot be found');\n  }\n  // eslint-disable-next-line require-await\n  async fix() {\n    return (\n      `${\n        'bundletool.jar'.bold\n      } is used to handle Android App Bundle. Please read http://appium.io/docs/en/writing-running-appium/android/android-appbundle/ to install it` +\n      `${\n        system.isWindows()\n          ? '. Also consider adding the \".jar\" extension into your PATHEXT environment variable in order to fix the problem for Windows'\n          : ''\n      }`\n    );\n  }\n}\nchecks.push(new OptionalAppBundleCheck());\n\nclass OptionalGstreamerCheck extends DoctorCheck {\n  GSTREAMER_BINARY = `gst-launch-1.0${system.isWindows() ? '.exe' : ''}`;\n  GST_INSPECT_BINARY = `gst-inspect-1.0${system.isWindows() ? '.exe' : ''}`;\n\n  async diagnose() {\n    const gstreamerPath = await resolveExecutablePath(this.GSTREAMER_BINARY);\n    const gstInspectPath = await resolveExecutablePath(this.GST_INSPECT_BINARY);\n\n    return gstreamerPath && gstInspectPath\n      ? okOptional(\n          `${this.GSTREAMER_BINARY} and ${this.GST_INSPECT_BINARY} are installed at: ${gstreamerPath} and ${gstInspectPath}`\n        )\n      : nokOptional(`${this.GSTREAMER_BINARY} and/or ${this.GST_INSPECT_BINARY} cannot be found`);\n  }\n  // eslint-disable-next-line require-await\n  async fix() {\n    return (\n      `${\n        `${this.GSTREAMER_BINARY} and ${this.GST_INSPECT_BINARY}`.bold\n      } are used to stream the screen of the device under test. ` +\n      'Please read https://appium.io/docs/en/writing-running-appium/android/android-screen-streaming/ to install them and for more details'\n    );\n  }\n}\nchecks.push(new OptionalGstreamerCheck());\n\nexport {\n  EnvVarAndPathCheck,\n  AndroidToolCheck,\n  JavaOnPathCheck,\n  OptionalAppBundleCheck,\n  OptionalGstreamerCheck,\n};\nexport default checks;\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,IAAIA,MAAM,GAAG,EAAb;AAEA,MAAMC,QAAQ,GAAGC,eAAA,CAAOC,SAAP,KAAqB,aAArB,GAAqC,YAAtD;AAEAH,MAAM,CAACI,IAAP,CAAY,IAAIC,YAAJ,CAAuB,cAAvB,CAAZ;AACAL,MAAM,CAACI,IAAP,CAAY,IAAIC,YAAJ,CAAuB,WAAvB,CAAZ;;AAGA,MAAMC,eAAN,SAA8BC,mBAA9B,CAA0C;EAC1B,MAARC,QAAQ,GAAG;IACf,IAAIC,OAAO,CAACC,GAAR,CAAYC,SAAhB,EAA2B;MACzB,MAAMC,WAAW,GAAGC,aAAA,CAAKC,OAAL,CAAaL,OAAO,CAACC,GAAR,CAAYC,SAAzB,EAAoC,KAApC,CAApB;;MACA,OAAO,CAAC,MAAMI,WAAA,CAAGC,MAAH,CAAUJ,WAAV,CAAP,IACH,IAAAK,SAAA,EAAI,iCAAgCR,OAAO,CAACC,GAAR,CAAYC,SAAU,GAA1D,CADG,GAEH,IAAAO,UAAA,EACG,yCAAwCT,OAAO,CAACC,GAAR,CAAYC,SAAU,KAA/D,GACG,MAAKV,QAAS,yBAFnB,CAFJ;IAMD;;IACD,OAAO,IAAAiB,UAAA,EACJ,gBAAejB,QAAS,gEADpB,CAAP;EAGD;;EAEDkB,GAAG,GAAG;IACJ,OAAQ,OAAMlB,QAAS,8EAAvB;EACD;;AAlBuC;;;;AAsB1C,MAAMmB,gBAAN,SAA+Bb,mBAA/B,CAA2C;EACzCc,WAAW,GAAG;IACZ;IACA,KAAKC,KAAL,GAAa,CAAC,KAAD,EAAQ,UAAR,EAAqB,cAAapB,eAAA,CAAOC,SAAP,KAAqB,MAArB,GAA8B,EAAG,EAAnE,CAAb;IACA,KAAKoB,UAAL,GAAkB,EAAlB;EACD;;EAEa,MAARf,QAAQ,GAAG;IACf,MAAMgB,WAAW,GAAG,KAAKF,KAAL,CAAWG,IAAX,CAAgB,IAAhB,CAApB;IACA,MAAMC,OAAO,GAAG,IAAAC,4BAAA,GAAhB;;IACA,IAAI,CAACD,OAAL,EAAc;MACZ,OAAO,IAAAR,UAAA,EACJ,GAAEM,WAAY,0EADV,CAAP;IAGD;;IAEDI,eAAA,CAAIC,IAAJ,CAAU,eAAcL,WAAY,EAApC;;IAEA,KAAK,MAAMM,MAAX,IAAqB,KAAKR,KAA1B,EAAiC;MAC/B,IAAI;QACFM,eAAA,CAAIC,IAAJ,CAAU,SAAQC,MAAO,WAAU,MAAM,IAAAC,+BAAA,EAAqBD,MAArB,CAA6B,EAAtE;MACD,CAFD,CAEE,OAAOE,CAAP,EAAU;QACV,KAAKT,UAAL,CAAgBnB,IAAhB,CAAqB0B,MAArB;MACD;IACF;;IAED,IAAI,KAAKP,UAAL,CAAgBU,MAAhB,GAAyB,CAA7B,EAAgC;MAC9B,OAAO,IAAAf,UAAA,EAAK,GAAE,KAAKK,UAAL,CAAgBE,IAAhB,CAAqB,IAArB,CAA2B,0BAAyBC,OAAQ,GAAnE,CAAP;IACD;;IAED,OAAO,IAAAT,SAAA,EAAI,GAAEO,WAAY,WAAUE,OAAQ,EAApC,CAAP;EACD;;EAEDP,GAAG,GAAG;IACJ,IAAI,OAAOV,OAAO,CAACC,GAAR,CAAYwB,YAAnB,KAAoC,WAAxC,EAAqD;MACnD,OAAQ,sBAAqB,eAAeC,IAAK,+BAAjD;IACD;;IAED,OACG,oBAAmB,KAAKZ,UAAL,CAAgBE,IAAhB,CAAqB,IAArB,EAA2BU,IAAK,kBAAiB,OAAOA,IAAK,IAAjF,GACA,yDADA,GAEA,kFAHF;EAKD;;AA3CwC;;;AA6C3CnC,MAAM,CAACI,IAAP,CAAY,IAAIgB,gBAAJ,EAAZ;AACApB,MAAM,CAACI,IAAP,CAAY,IAAIE,eAAJ,EAAZ;;AAEA,MAAM8B,sBAAN,SAAqC7B,mBAArC,CAAiD;EACjC,MAARC,QAAQ,GAAG;IACf,MAAM6B,cAAc,GAAG,MAAM,IAAAC,4BAAA,EAAsB,gBAAtB,CAA7B;IACA,OAAOD,cAAc,GACjB,IAAAE,iBAAA,EAAY,mCAAkCF,cAAe,EAA7D,CADiB,GAEjB,IAAAG,kBAAA,EAAY,gCAAZ,CAFJ;EAGD;;EAEQ,MAAHrB,GAAG,GAAG;IACV,OACG,GACC,iBAAiBgB,IAClB,6IAFD,GAGC,GACCjC,eAAA,CAAOC,SAAP,KACI,4HADJ,GAEI,EACL,EARH;EAUD;;AAnB8C;;;AAqBjDH,MAAM,CAACI,IAAP,CAAY,IAAIgC,sBAAJ,EAAZ;;AAEA,MAAMK,sBAAN,SAAqClC,mBAArC,CAAiD;EAC/CmC,gBAAgB,GAAI,iBAAgBxC,eAAA,CAAOC,SAAP,KAAqB,MAArB,GAA8B,EAAG,EAArD;EAChBwC,kBAAkB,GAAI,kBAAiBzC,eAAA,CAAOC,SAAP,KAAqB,MAArB,GAA8B,EAAG,EAAtD;;EAEJ,MAARK,QAAQ,GAAG;IACf,MAAMoC,aAAa,GAAG,MAAM,IAAAN,4BAAA,EAAsB,KAAKI,gBAA3B,CAA5B;IACA,MAAMG,cAAc,GAAG,MAAM,IAAAP,4BAAA,EAAsB,KAAKK,kBAA3B,CAA7B;IAEA,OAAOC,aAAa,IAAIC,cAAjB,GACH,IAAAN,iBAAA,EACG,GAAE,KAAKG,gBAAiB,QAAO,KAAKC,kBAAmB,sBAAqBC,aAAc,QAAOC,cAAe,EADnH,CADG,GAIH,IAAAL,kBAAA,EAAa,GAAE,KAAKE,gBAAiB,WAAU,KAAKC,kBAAmB,kBAAvE,CAJJ;EAKD;;EAEQ,MAAHxB,GAAG,GAAG;IACV,OACG,GACE,GAAE,KAAKuB,gBAAiB,QAAO,KAAKC,kBAAmB,EAAxD,CAA0DR,IAC3D,2DAFD,GAGA,qIAJF;EAMD;;AAtB8C;;;AAwBjDnC,MAAM,CAACI,IAAP,CAAY,IAAIqC,sBAAJ,EAAZ;eASezC,M"}